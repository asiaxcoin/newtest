<!DOCTYPE html>
<html lang="en">
<head>
    <meta charset="UTF-8">
    <meta name="viewport" content="width=device-width, initial-scale=1.0, maximum-scale=1.0, user-scalable=no">
    <title>AsiaX Pro Dashboard</title>
    <script src="https://cdn.tailwindcss.com"></script>
    <script src="https://cdnjs.cloudflare.com/ajax/libs/ethers/6.7.0/ethers.umd.min.js"></script>
    <link rel="stylesheet" href="https://cdnjs.cloudflare.com/ajax/libs/font-awesome/6.4.0/css/all.min.css">
    <style>
        /* Horizontal Fix & No Zoom */
        html, body { 
            background-color: #000; color: #fff; font-family: 'Inter', sans-serif;
            overflow-x: hidden; width: 100%; position: relative;
            touch-action: pan-y;
        }
        .gold-text { color: #f3ba2f; }
        .gold-grad-text { background: linear-gradient(180deg, #FFD700 0%, #B8860B 100%); -webkit-background-clip: text; -webkit-text-fill-color: transparent; }
        .bg-card { background-color: #0D0D0D; border: 1px solid #1A1A1A; border-radius: 12px; }
        .btn-gold { background: linear-gradient(180deg, #FFD700 0%, #B8860B 100%); color: #000; font-weight: bold; border-radius: 8px; display: flex; align-items: center; justify-content: center; }
        .btn-cyan { background: #00F5FF; color: #000; font-weight: bold; border-radius: 8px; }
        .input-box { background: #111; border: 1px solid #222; color: #fff; border-radius: 6px; padding: 12px; width: 100%; font-size: 13px; }
        .app-container { max-width: 410px; margin: 0 auto; padding: 12px; overflow-x: hidden; }
        
        /* Box Headers Logo - Same as Top Logo */
        .box-header-logo { width: 150px; height: auto; margin: 25px auto 10px auto; display: block; }

        .circle-lg { width: 85px; height: 85px; border: 4px solid #151515; border-top-color: #f3ba2f; border-radius: 50%; display: flex; align-items: center; justify-content: center; font-size: 12px; margin: 0 auto; font-weight: bold; }
        .pool-dot { width: 45px; height: 45px; border: 2px solid #222; border-top-color: #f3ba2f; border-radius: 50%; display: flex; align-items: center; justify-content: center; font-size: 8px; font-weight: bold; transition: 0.3s; }
        .pool-done { border-top-color: #22c55e !important; color: #22c55e !important; border-color: #22c55e; }
        .pool-expired { border-top-color: #ef4444 !important; opacity: 0.4; }
        .roi-progress-bg { width: 100%; background: #1A1A1A; height: 8px; border-radius: 10px; margin-top: 10px; overflow: hidden; border: 1px solid #222; }
        .roi-progress-fill { height: 100%; background: linear-gradient(90deg, #22c55e, #00F5FF); width: 100%; transition: width 0.5s ease-in-out; }
        
        /* Social Icons Box */
        .soc-img-container { width: 48px; height: 48px; border-radius: 50%; overflow: hidden; display: flex; align-items: center; justify-content: center; transition: transform 0.2s; cursor: pointer; }
        .soc-img-container img { width: 100%; height: 100%; object-fit: cover; }
    </style>
</head>
<body>

<div class="app-container">
    <div class="flex flex-col items-center py-6">
        <img src="prologo.png" id="appLogo" alt="AsiaX Pro Logo" style="width: 150px; height: auto;">
        <button onclick="connectWallet()" id="walletBtn" class="mt-4 btn-gold w-full py-1.5 uppercase text-[11px] tracking-widest shadow-lg shadow-yellow-900/10">Connect Wallet</button>
    </div>

   
    <div class="bg-card p-4 mb-4 border-[#222]">
        <div class="space-y-3">
            <div>
                <p class="text-[9px] text-gray-500 uppercase font-bold mb-1 ml-1">My Address</p>
                <div class="input-box flex justify-between items-center opacity-60">
                    <span id="userAddr" class="truncate text-[10px]">0x0000...0000</span>
                    <i class="fa-solid fa-clone text-[10px] cursor-pointer" onclick="copyText('userAddr')"></i>
                </div>
            </div>
            <div>
                <p class="text-[9px] text-gray-500 uppercase font-bold mb-1 ml-1">Upline Address</p>
                <div class="input-box flex justify-between items-center opacity-60">
                    <span id="uplineAddrDisplay" class="truncate text-[10px]">0x0000...0000</span>
                    <i class="fa-solid fa-link text-[10px]"></i>
                </div>
            </div>
        </div>
    </div>

    <img src="income.png" class="box-header-logo">
    <div class="bg-card p-6 mb-4 text-center border-[#222]">
        <p class="text-[10px] text-gray-400 uppercase font-bold tracking-widest">Total Income</p>
        <h2 class="text-4xl font-bold mt-2"><span id="totalIncomeDisplay">0.00</span> <span class="text-sm gold-grad-text italic font-bold">AX</span></h2>
        <div class="grid grid-cols-5 gap-0 mt-8">
            <div class="text-center"><i class="fa-solid fa-bolt text-yellow-500 text-lg"></i><p class="text-[7px] text-gray-500 uppercase">ROI</p></div>
            <div class="text-center"><i class="fa-solid fa-crown text-yellow-600 text-lg"></i><p class="text-[7px] text-gray-500 uppercase">Sponsor</p></div>
            <div class="text-center"><i class="fa-solid fa-users-rays text-yellow-700 text-lg"></i><p class="text-[7px] text-gray-500 uppercase">Gen</p></div>
            <div class="text-center"><i class="fa-solid fa-trophy text-yellow-500 text-lg"></i><p class="text-[7px] text-gray-500 uppercase">Pools</p></div>
            <div class="text-center"><i class="fa-solid fa-star text-yellow-400 text-lg"></i><p class="text-[7px] text-gray-500 uppercase">Top</p></div>
        </div>
    </div>

    <img src="invest.png" class="box-header-logo">
    <div class="bg-card p-4 mb-4 border-[#222]">
        <div class="flex justify-between items-center mb-1">
            <p class="text-[10px] text-gray-400 uppercase font-bold">Your Investments</p>
            <p class="text-[8px] text-cyan-400 font-bold uppercase">ROI Limit: <span id="roiLimitDisplay">0.00</span> AX</p>
        </div>
        <div class="flex justify-between items-end">
            <div>
                <p class="text-[9px] text-gray-500 uppercase">Deposit (AX)</p>
                <h3 class="text-xl font-bold" id="totalDeposit">0.00 AX</h3>
            </div>
            <div class="text-right">
                <p class="text-[9px] text-gray-500 uppercase">ROI Earned</p>
                <h3 class="text-xl font-bold gold-grad-text"><span id="roiEarnedDisplay">0.00</span> AX</h3>
                <p class="text-[8px] text-gray-500 font-bold uppercase"><span id="roiRemainingPercent">100</span>% REMAINING</p>
            </div>
        </div>
        <div class="roi-progress-bg"><div id="roiBar" class="roi-progress-fill" style="width: 100%;"></div></div>
    </div>

    <img src="reffer.png" class="box-header-logo">
    <div class="mb-4">
        <p class="text-[9px] text-gray-500 uppercase font-bold mb-1 ml-1">Your Referral Link</p>
        <div class="flex gap-1">
            <input type="text" id="refLink" readonly value="Connect Wallet" class="input-box flex-1 py-2 text-[10px] border-[#222]">
            <button onclick="copyText('refLink')" class="btn-gold px-4 text-[10px]">COPY</button>
        </div>
    </div>

    <img src="with.png" class="box-header-logo">
    <div class="bg-card p-4 mb-4 border-[#222]">
        <p class="text-[10px] text-gray-400 uppercase font-bold mb-3">Withdraw to your Wallet</p>
        <div class="relative">
            <input type="number" id="withdrawInput" placeholder="Amount (AX)" class="input-box pr-16 text-cyan-400 font-bold">
            <button onclick="setMaxWithdraw()" class="absolute right-3 top-3 text-cyan-400 font-bold text-[11px]">MAX</button>
        </div>
        <button onclick="walletWithdraw()" class="btn-gold w-full py-2.5 mt-3 text-xs uppercase">Withdraw</button>
        <div class="text-center mt-4">
            <p class="text-[9px] text-gray-500 uppercase font-bold">Wallet Balance in Contract</p>
            <h4 class="text-2xl font-bold mt-1" id="contractWalletBal">0.00 AX</h4>
        </div>
    </div>

    <img src="allincome.png" class="box-header-logo">
    <div class="bg-card p-4 mb-4 space-y-4 border-[#222]">
        <div class="flex justify-between items-center text-[11px] font-bold uppercase">
            <span class="text-gray-500">Pending ROI</span><span id="roiInc">0.00 AX</span>
        </div>
        <div class="flex justify-between items-center text-[11px] font-bold uppercase">
            <span class="text-gray-500">Sponsor Income</span><span id="spInc">0.00 AX</span>
        </div>
        <div class="flex justify-between items-center text-[11px] font-bold uppercase">
            <span class="text-gray-500">Generations Income</span><span id="genInc">0.00 AX</span>
        </div>
        <div class="flex justify-between items-center text-[11px] font-bold uppercase">
            <span class="text-gray-500">Pool Income</span><span id="poolInc">0.00 AX</span>
        </div>
        <div class="flex gap-2 pt-2">
            <button onclick="claimPoolRewards()" class="btn-gold flex-1 py-1.5 text-[9px] uppercase font-black">Claim Pool Rewards</button>
            <button onclick="withdrawIncome()" class="btn-cyan flex-1 py-1.5 text-[9px] uppercase font-black">Claim Income Rewards</button>
        </div>
    </div>

    <img src="buy.png" class="box-header-logo">
    <div class="bg-card p-4 mb-4 border-[#222]">
        <div class="flex justify-between items-center mb-4">
            <span class="text-[10px] text-gray-400 uppercase font-bold italic">Buy FIX <span class="text-white ml-2 text-[11px] not-italic">Fixed Rate</span></span>
            <span class="text-cyan-400 text-[10px] font-bold">1 USDT = <span id="fixRateDisplay">--</span> AX</span>
        </div>
        <div class="relative mb-2">
            <input type="number" id="buyUsdtInput" oninput="calculateSwap()" placeholder="USDT Amount" class="input-box pr-16 text-xs italic">
            <button onclick="setMaxUsdt()" class="absolute right-3 top-3 text-cyan-400 font-bold text-[11px]">MAX</button>
        </div>
        <div class="text-[10px] text-center text-gray-500 mb-3">Get Est: <span id="estAx" class="text-white font-bold">0.00</span> AX</div>
        <button onclick="buyAsiaXFix()" class="btn-gold w-full py-3 text-xs uppercase tracking-widest flex items-center justify-center gap-2">
            <i class="fa-solid fa-coins"></i> BUY ASIAX FIX
        </button>
    </div>

    <img src="join.png" class="box-header-logo">
    <div class="bg-card p-4 mb-4 border-[#222]">
        <div class="flex justify-between items-center mb-4">
            <span class="text-[10px] text-gray-400 uppercase font-bold italic">Invest <span class="text-white ml-2 text-[11px] not-italic">Join Network</span></span>
        </div>
        <input type="text" id="uplineInput" placeholder="Referrer Address (Required)" class="input-box mb-2 text-xs italic">
        <div class="relative">
            <input type="number" id="investAmount" placeholder="Amount (AX)" class="input-box pr-16 text-xs">
            <button onclick="setMaxInvest()" class="absolute right-3 top-3 text-cyan-400 font-bold text-[11px]">MAX</button>
        </div>
        <button onclick="invest()" class="btn-cyan w-full py-3 mt-4 text-xs uppercase tracking-widest flex items-center justify-center gap-2">
            <i class="fa-solid fa-rocket"></i> Invest Now
        </button>
    </div>

    <img src="balance.png" class="box-header-logo">
    <div class="bg-card p-4 mb-4 border-[#222]">
        <p class="text-[10px] text-gray-400 uppercase font-bold mb-4 text-center tracking-widest">Your Wallet Balance</p>
        <div class="grid grid-cols-3 text-center">
            <div><p class="text-[8px] text-gray-500 uppercase font-bold">ASIAX</p><h5 id="bal-asiax" class="text-sm font-bold">0.00</h5></div>
            <div><p class="text-[8px] text-gray-500 uppercase font-bold">USDT</p><h5 id="bal-usdt" class="text-sm font-bold">0.00</h5></div>
            <div><p class="text-[8px] text-gray-500 uppercase font-bold">POL</p><h5 id="bal-pol" class="text-sm font-bold">0.00</h5></div>
        </div>
    </div>

    <img src="com.png" class="box-header-logo">
    <div class="bg-card p-4 mb-4 border-[#222]">
        <p class="text-[10px] text-gray-400 uppercase font-bold mb-5 tracking-widest text-center">Community Links</p>
        <div class="flex justify-center gap-10 py-4">
            <a href="https://www.youtube.com/@ASIAXPRO" target="_blank" class="text-center">
                <div class="soc-img-container shadow-[0_0_15px_rgba(255,0,0,0.3)] hover:scale-110">
                    <img src="youtube.png" alt="YouTube">
                </div>
                <p class="text-[8px] mt-2 text-gray-400 font-bold uppercase">YouTube</p>
            </a>
            <a href="https://polygonscan.com/address/0xE36b5223d488322fAc2dDda937E5aB226E83Fbbd" target="_blank" class="text-center">
                <div class="soc-img-container shadow-[0_0_15px_rgba(255,255,255,0.2)] hover:scale-110">
                    <img src="polygon.png" alt="Website">
                </div>
                <p class="text-[8px] mt-2 text-gray-400 font-bold uppercase">Polygon</p>
            </a>
            <a href="https://t.me/asiax_coin" target="_blank" class="text-center">
                <div class="soc-img-container shadow-[0_0_15px_rgba(0,136,204,0.3)] hover:scale-110">
                    <img src="telegram.png" alt="Telegram">
                </div>
                <p class="text-[8px] mt-2 text-gray-400 font-bold uppercase">Telegram</p>
            </a>
        </div>
    </div>

    <img src="team.png" class="box-header-logo">
    <div class="bg-card p-4 mb-4 border-[#222]">
        <p class="text-[10px] text-gray-400 uppercase font-bold mb-5 tracking-widest text-center">Your Network</p>
        <div class="flex justify-between items-center text-center">
            <div><div id="directs" class="circle-lg">0/10</div><p class="text-[8px] text-gray-500 mt-2 uppercase font-bold">Directs</p></div>
            <div><div id="team" class="circle-lg" style="border-top-color:#00F5FF">0</div><p class="text-[8px] text-gray-500 mt-2 uppercase font-bold">Total Team</p></div>
            <div><div id="business" class="circle-lg">0</div><p class="text-[8px] text-gray-500 mt-2 uppercase font-bold">Business (AX)</p></div>
        </div>
    </div>

    <img src="timer.png" class="box-header-logo">
    <div class="bg-card p-4 mb-12 border-[#222]">
        <div class="flex justify-between items-center mb-4">
            <p class="text-[10px] text-gray-400 uppercase font-bold">Pool Performance</p>
            <p id="poolTimer" class="text-[8px] bg-red-600 px-2 py-0.5 rounded-sm font-bold animate-pulse text-white">DEADLINE: --:--</p>
        </div>
        <div class="flex justify-around items-center text-center">
            <div><div id="dot-silver" class="pool-dot">SILVER</div><p id="timer-silver" class="text-[6px] text-gray-500 mt-1 font-bold">30 Days</p></div>
            <div><div id="dot-gold" class="pool-dot">GOLD</div><p id="timer-gold" class="text-[6px] text-gray-500 mt-1 font-bold">75 Days</p></div>
            <div><div id="dot-plat" class="pool-dot">PLAT</div><p id="timer-plat" class="text-[6px] text-gray-500 mt-1 font-bold">135 Days</p></div>
        </div>
    </div>
</div>

<script>
    // --- SETTINGS ---
    const MAIN_ADDR = "0xF6d0d72AAf0Bbf5C459E680f1e6E75E3B1ce1f06";
    const BUY_FIX_ADDR = "0xCA275a92B4845f3caD2995FaeC00733849C4e6D1"; 
    const TOKEN_ADDR = "0xE36b5223d488322fAc2dDda937E5aB226E83Fbbd";
    const USDT_ADDR = "0xc2132D05D31c914a87C6611C10748AEb04B58e8F";

    const ABI = [
        "function invest(address _referrer, uint256 _amount) external",
        "function withdraw() external",
        "function claimPoolRewards() external",
        "function WalletWithdraw(uint256 _amount) external",
        "function userBasic(address) view returns (address referrer,uint256 totalInvestment,uint256 firstInvestmentTime,uint256 lastROICalculation,uint256 totalWithdrawn,uint256 sponsorIncome,uint256 generationIncome,uint256 totalROIWithdrawn,uint256 totalPoolIncomeWithdrawn,uint256 totalSponsorWithdrawn,uint256 totalGenerationWithdrawn)",
        "function userNetwork(address) view returns (uint256 totalTeam,uint256 activeDirects,bool silverPoolMember,bool goldPoolMember,bool platinumPoolMember,uint256 silverPoolJoinTime,uint256 goldPoolJoinTime,uint256 platinumPoolJoinTime)",
        "function getUserIncome(address _user) view returns (uint256 pendingROI,uint256 sponsorInc,uint256 generationInc,uint256 poolRewards,uint256 totalWithdrawn)",
        "function userWallet(address) view returns (uint256 balance,uint256 lastWithdrawalTime,uint256 withdrawnInLast24Hours)",
        "function getBusinessAndAmount(address) view returns (uint256[50] levelBusiness, uint256[50] levelCount)"
    ];

    const BUY_FIX_ABI = ["function buyAsiaX(uint256 usdtAmount) external", "function getHumanPrice() view returns (uint256)"];
    const ERC20_ABI = ["function balanceOf(address owner) view returns (uint256)", "function approve(address spender, uint256 amount) returns (bool)"];

    let signer, provider, mainContract, buyFixContract, tokenContract, usdtContract;
    let currentRate = 1;

    const nF = (v, d=18) => parseFloat(ethers.formatUnits(v || 0, d)).toFixed(2);

    async function connectWallet() {
        if (!window.ethereum) return alert("Install MetaMask");
        provider = new ethers.BrowserProvider(window.ethereum);
        await provider.send("eth_requestAccounts", []);
        signer = await provider.getSigner();
        const addr = await signer.getAddress();
        
        mainContract = new ethers.Contract(MAIN_ADDR, ABI, signer);
        buyFixContract = new ethers.Contract(BUY_FIX_ADDR, BUY_FIX_ABI, signer);
        tokenContract = new ethers.Contract(TOKEN_ADDR, ERC20_ABI, signer);
        usdtContract = new ethers.Contract(USDT_ADDR, ERC20_ABI, signer);

        document.getElementById('walletBtn').innerText = addr.substring(0,6)+"...";
        document.getElementById('userAddr').innerText = addr;
        
        const refUrl = window.location.origin + window.location.pathname + "?ref=" + addr;
        document.getElementById('refLink').value = refUrl;
        
        loadData(addr);
    }

    async function loadData(addr) {
        try {
            const basic = await mainContract.userBasic(addr);
            const network = await mainContract.userNetwork(addr);
            const income = await mainContract.getUserIncome(addr);
            const wallet = await mainContract.userWallet(addr);
            const bizData = await mainContract.getBusinessAndAmount(addr);

            document.getElementById('uplineAddrDisplay').innerText = basic.referrer;

            let totalBusiness = 0;
            for(let i=0; i<50; i++) {
                totalBusiness += parseFloat(ethers.formatUnits(bizData.levelBusiness[i], 18));
            }
            document.getElementById('business').innerText = totalBusiness.toFixed(0);

            document.getElementById('bal-pol').innerText = nF(await provider.getBalance(addr));
            document.getElementById('bal-asiax').innerText = nF(await tokenContract.balanceOf(addr));
            document.getElementById('bal-usdt').innerText = nF(await usdtContract.balanceOf(addr), 6);

            const deposit = parseFloat(ethers.formatUnits(basic.totalInvestment, 18));
            const roiWithdrawn = parseFloat(ethers.formatUnits(basic.totalROIWithdrawn, 18));
            const maxROI = deposit * 1.75;
            document.getElementById('totalDeposit').innerText = deposit.toFixed(2) + " AX";
            document.getElementById('roiLimitDisplay').innerText = maxROI.toFixed(2);
            document.getElementById('roiEarnedDisplay').innerText = roiWithdrawn.toFixed(2);

            let remainingPercent = 100;
            if(maxROI > 0) {
                remainingPercent = Math.max(0, (100 - (roiWithdrawn / maxROI * 100))).toFixed(0);
            }
            document.getElementById('roiRemainingPercent').innerText = remainingPercent;
            document.getElementById('roiBar').style.width = remainingPercent + "%";

            document.getElementById('totalIncomeDisplay').innerText = nF(income.totalWithdrawn);
            document.getElementById('roiInc').innerText = nF(income.pendingROI) + " AX";
            document.getElementById('spInc').innerText = nF(income.sponsorInc) + " AX";
            document.getElementById('genInc').innerText = nF(income.generationInc) + " AX";
            document.getElementById('poolInc').innerText = nF(income.poolRewards) + " AX";
            document.getElementById('contractWalletBal').innerText = nF(wallet.balance) + " AX";
            
            document.getElementById('directs').innerText = network.activeDirects + "/10";
            document.getElementById('team').innerText = network.totalTeam;

            if(network.silverPoolMember) document.getElementById('dot-silver').classList.add('pool-done');
            if(network.goldPoolMember) document.getElementById('dot-gold').classList.add('pool-done');
            if(network.platinumPoolMember) document.getElementById('dot-plat').classList.add('pool-done');

            buyFixContract.getHumanPrice().then(price => {
                currentRate = Number(price);
                document.getElementById('fixRateDisplay').innerText = currentRate;
            });

        } catch (e) { console.error(e); }
    }

    function calculateSwap() {
        const val = document.getElementById('buyUsdtInput').value;
        document.getElementById('estAx').innerText = (val * currentRate).toFixed(2);
    }

    async function invest() {
        const amt = document.getElementById('investAmount').value;
        const ref = document.getElementById('uplineInput').value || MAIN_ADDR;
        const wei = ethers.parseUnits(amt, 18);
        try {
            await (await tokenContract.approve(MAIN_ADDR, wei)).wait();
            await (await mainContract.invest(ref, wei)).wait();
            loadData(await signer.getAddress());
        } catch(e) { alert("Failed"); }
    }

    async function buyAsiaXFix() {
        const amt = document.getElementById('buyUsdtInput').value;
        if(!amt) return;
        try {
            const wei = ethers.parseUnits(amt, 6);
            await (await usdtContract.approve(BUY_FIX_ADDR, wei)).wait();
            await (await buyFixContract.buyAsiaX(wei)).wait();
            loadData(await signer.getAddress());
        } catch(e) { alert("Failed"); }
    }

    async function withdrawIncome() { await (await mainContract.withdraw()).wait(); loadData(await signer.getAddress()); }
    async function claimPoolRewards() { await (await mainContract.claimPoolRewards()).wait(); loadData(await signer.getAddress()); }
    async function walletWithdraw() { 
        const amt = document.getElementById('withdrawInput').value;
        await (await mainContract.WalletWithdraw(ethers.parseUnits(amt, 18))).wait(); loadData(await signer.getAddress()); 
    }

    function copyText(id) { 
        const el = document.getElementById(id);
        const valToCopy = el.tagName === 'INPUT' ? el.value : el.innerText;
        navigator.clipboard.writeText(valToCopy); 
        alert("Referral Link Copied!"); 
    }
</script>
</body>
</html>


