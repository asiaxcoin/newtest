<!DOCTYPE html>
<html lang="en">
<head>
    <meta charset="UTF-8">
    <meta name="viewport" content="width=device-width, initial-scale=1.0, maximum-scale=1.0, user-scalable=no">
    <title>AsiaX Pro Dashboard</title>
    <script src="https://cdn.tailwindcss.com"></script>
    <link rel="stylesheet" href="https://cdnjs.cloudflare.com/ajax/libs/font-awesome/6.4.0/css/all.min.css">
    
    <script src="https://cdnjs.cloudflare.com/ajax/libs/ethers/6.7.0/ethers.umd.min.js"></script>
    
    <script type="module">
        import { createWeb3Modal, defaultConfig } from 'https://esm.run/@web3modal/ethers@latest'

        const projectId = '813cf5c3987af12efdc809472c55eb8a'; 

        const polygon = {
            chainId: 137,
            name: 'Polygon',
            currency: 'POL',
            explorerUrl: 'https://polygonscan.com',
            rpcUrl: 'https://polygon-rpc.com'
        }

        const metadata = {
            name: 'AsiaX Pro',
            description: 'AsiaX Pro Dashboard',
            url: window.location.origin,
            icons: ['https://avatars.githubusercontent.com/u/37784886']
        }

        const modal = createWeb3Modal({
            ethersConfig: defaultConfig({ metadata }),
            chains: [polygon],
            projectId,
            enableAnalytics: true,
            themeMode: 'dark'
        })

        // Global Variable for setup
        window.connectWallet = () => modal.open();

        // Listen for connection
        modal.subscribeProvider(async (state) => {
            if (state.isConnected) {
                // Get provider from modal
                const walletProvider = state.provider;
                if(walletProvider) setupEthers(walletProvider);
            }
        });

        // Moved setupEthers inside module to access modal/state properly
        async function setupEthers(walletProvider) {
            try {
                window.provider = new ethers.BrowserProvider(walletProvider);
                window.signer = await window.provider.getSigner();
                const addr = await window.signer.getAddress();
                
                window.mainContract = new ethers.Contract(MAIN_ADDR, ABI, window.signer);
                window.buyFixContract = new ethers.Contract(BUY_FIX_ADDR, BUY_FIX_ABI, window.signer);
                window.tokenContract = new ethers.Contract(TOKEN_ADDR, ERC20_ABI, window.signer);
                window.usdtContract = new ethers.Contract(USDT_ADDR, ERC20_ABI, window.signer);

                document.getElementById('walletBtn').innerText = addr.substring(0,6)+"..."+addr.substring(38);
                document.getElementById('userAddr').innerText = addr;
                
                const refLink = window.location.origin + window.location.pathname + "?ref=" + addr;
                document.getElementById('refLink').value = refLink;

                const urlParams = new URLSearchParams(window.location.search);
                const refInUrl = urlParams.get('ref');
                if(refInUrl && ethers.isAddress(refInUrl)) {
                    document.getElementById('uplineInput').value = refInUrl;
                }

                loadData(addr);
                setInterval(() => loadData(addr), 30000);
            } catch (e) { console.error("Setup Error:", e); }
        }
    </script>

    <style>
        html, body { background-color: #000; color: #fff; font-family: 'Inter', sans-serif; overflow-x: hidden; width: 100%; position: relative; touch-action: pan-y; }
        .gold-grad-text { background: linear-gradient(180deg, #FFD700 0%, #B8860B 100%); -webkit-background-clip: text; -webkit-text-fill-color: transparent; }
        .bg-card { background-color: #0D0D0D; border: 1px solid #1A1A1A; border-radius: 12px; }
        .btn-gold { background: linear-gradient(180deg, #FFD700 0%, #B8860B 100%); color: #000; font-weight: bold; border-radius: 8px; display: flex; align-items: center; justify-content: center; }
        .btn-cyan { background: #00F5FF; color: #000; font-weight: bold; border-radius: 8px; }
        .input-box { background: #111; border: 1px solid #222; color: #fff; border-radius: 6px; padding: 12px; width: 100%; font-size: 13px; }
        .app-container { max-width: 410px; margin: 0 auto; padding: 12px; overflow-x: hidden; }
        .box-header-logo { width: 150px; height: auto; margin: 25px auto 10px auto; display: block; }
        .timer-row { display: flex; justify-content: center; align-items: center; gap: 12px; background: #080808; padding: 12px; border-radius: 8px; border: 1px solid #222; }
        .timer-part { display: flex; align-items: baseline; gap: 2px; }
        .timer-val { font-size: 24px; font-weight: 900; color: #f3ba2f; line-height: 1; }
        .timer-label { font-size: 10px; color: #666; text-transform: uppercase; font-weight: bold; }
        .circle-lg { width: 85px; height: 85px; border: 4px solid #151515; border-top-color: #f3ba2f; border-radius: 50%; display: flex; align-items: center; justify-content: center; font-size: 12px; margin: 0 auto; font-weight: bold; }
        .pool-dot { width: 35px; height: 35px; border: 2px solid #222; border-top-color: #f3ba2f; border-radius: 50%; display: flex; align-items: center; justify-content: center; font-size: 7px; font-weight: bold; transition: 0.3s; }
        .pool-done { border-top-color: #22c55e !important; color: #22c55e !important; border-color: #22c55e; }
        .roi-progress-bg { width: 100%; background: #1A1A1A; height: 8px; border-radius: 10px; margin-top: 10px; overflow: hidden; border: 1px solid #222; }
        .roi-progress-fill { height: 100%; background: linear-gradient(90deg, #22c55e, #00F5FF); width: 0%; transition: width 0.5s; }
        .soc-img-container { width: 48px; height: 48px; border-radius: 50%; overflow: hidden; display: flex; align-items: center; justify-content: center; transition: 0.2s; cursor: pointer; }
        .soc-img-container img { width: 100%; height: 100%; object-fit: cover; }
    </style>
</head>
<body>

<div class="app-container">
    <div class="flex flex-col items-center py-6">
        <img src="prologo.png" style="width: 150px; height: auto;" alt="Logo">
        <button onclick="connectWallet()" id="walletBtn" class="mt-4 btn-gold w-full py-1.5 uppercase text-[11px] tracking-widest shadow-lg shadow-yellow-900/10">Connect Wallet</button>
    </div>

    <div class="bg-card p-4 mb-4 border-[#222]">
        <div class="space-y-3">
            <div>
                <p class="text-[9px] text-gray-500 uppercase font-bold mb-1 ml-1">My Address</p>
                <div class="input-box flex justify-between items-center opacity-60">
                    <span id="userAddr" class="truncate text-[10px]">0x0000...0000</span>
                    <i class="fa-solid fa-clone text-[10px] cursor-pointer" onclick="copyText('userAddr')"></i>
                </div>
            </div>
            <div>
                <p class="text-[9px] text-gray-500 uppercase font-bold mb-1 ml-1">Upline Address</p>
                <div class="input-box flex justify-between items-center opacity-60">
                    <span id="uplineAddrDisplay" class="truncate text-[10px]">0x0000...0000</span>
                    <i class="fa-solid fa-link text-[10px]"></i>
                </div>
            </div>
        </div>
    </div>

    <img src="income.png" class="box-header-logo">
    <div class="bg-card p-6 mb-4 text-center border-[#222]">
        <p class="text-[10px] text-gray-400 uppercase font-bold tracking-widest">Total Income Earned</p>
        <h2 class="text-4xl font-bold mt-2"><span id="totalIncomeDisplay">0.00</span> <span class="text-sm gold-grad-text italic font-bold">AX</span></h2>
        <div class="grid grid-cols-5 gap-0 mt-8">
            <div class="text-center"><i class="fa-solid fa-bolt text-yellow-500 text-lg"></i><p class="text-[7px] text-gray-500 uppercase">ROI</p></div>
            <div class="text-center"><i class="fa-solid fa-crown text-yellow-600 text-lg"></i><p class="text-[7px] text-gray-500 uppercase">Sponsor</p></div>
            <div class="text-center"><i class="fa-solid fa-users-rays text-yellow-700 text-lg"></i><p class="text-[7px] text-gray-500 uppercase">Gen</p></div>
            <div class="text-center"><i class="fa-solid fa-trophy text-yellow-500 text-lg"></i><p class="text-[7px] text-gray-500 uppercase">Pools</p></div>
            <div class="text-center"><i class="fa-solid fa-star text-yellow-400 text-lg"></i><p class="text-[7px] text-gray-500 uppercase">Top</p></div>
        </div>
    </div>

    <img src="invest.png" class="box-header-logo">
    <div class="bg-card p-4 mb-4 border-[#222]">
        <div class="flex justify-between items-center mb-1">
            <p class="text-[10px] text-gray-400 uppercase font-bold">Your Investments</p>
            <p class="text-[8px] text-cyan-400 font-bold uppercase">ROI Limit (175%): <span id="roiLimitDisplay">0.00</span> AX</p>
        </div>
        <div class="flex justify-between items-end">
            <div>
                <p class="text-[9px] text-gray-500 uppercase">Total Deposit</p>
                <h3 class="text-xl font-bold" id="totalDeposit">0.00 AX</h3>
            </div>
            <div class="text-right">
                <p class="text-[9px] text-gray-500 uppercase">ROI Withdrawn</p>
                <h3 class="text-xl font-bold gold-grad-text"><span id="roiEarnedDisplay">0.00</span> AX</h3>
                <p class="text-[8px] text-gray-500 font-bold uppercase"><span id="roiRemainingPercent">100</span>% REMAINING</p>
            </div>
        </div>
        <div class="roi-progress-bg"><div id="roiBar" class="roi-progress-fill"></div></div>
    </div>

    <img src="reffer.png" class="box-header-logo">
    <div class="mb-4">
        <p class="text-[9px] text-gray-500 uppercase font-bold mb-1 ml-1">Your Referral Link</p>
        <div class="flex gap-1">
            <input type="text" id="refLink" readonly value="Connect Wallet" class="input-box flex-1 py-2 text-[10px] border-[#222]">
            <button onclick="copyText('refLink')" class="btn-gold px-4 text-[10px]">COPY</button>
        </div>
    </div>

    <img src="with.png" class="box-header-logo">
    <div class="bg-card p-4 mb-4 border-[#222]">
        <p class="text-[10px] text-gray-400 uppercase font-bold mb-3">Withdraw to your wallet</p>
        <div class="relative">
            <input type="number" id="withdrawInput" placeholder="Amount (AX)" class="input-box pr-16 text-cyan-400 font-bold">
            <button onclick="setMaxWithdraw()" class="absolute right-3 top-3 text-cyan-400 font-bold text-[11px]">MAX</button>
        </div>
        <button onclick="walletWithdraw()" class="btn-gold w-full py-2.5 mt-3 text-xs uppercase">Confirm Withdrawal</button>
        <div class="text-center mt-4">
            <p class="text-[9px] text-gray-500 uppercase font-bold">Available in Internal Wallet</p>
            <h4 class="text-2xl font-bold mt-1" id="contractWalletBal">0.00 AX</h4>
        </div>
    </div>

    <img src="allincome.png" class="box-header-logo">
    <div class="bg-card p-4 mb-4 space-y-4 border-[#222]">
        <div class="flex justify-between items-center text-[11px] font-bold uppercase">
            <span class="text-gray-500">Pending ROI</span><span id="roiInc">0.00 AX</span>
        </div>
        <div class="flex justify-between items-center text-[11px] font-bold uppercase">
            <span class="text-gray-500">Sponsor Income</span><span id="spInc">0.00 AX</span>
        </div>
        <div class="flex justify-between items-center text-[11px] font-bold uppercase">
            <span class="text-gray-500">Generations Income</span><span id="genInc">0.00 AX</span>
        </div>
        <div class="flex justify-between items-center text-[11px] font-bold uppercase">
            <span class="text-gray-500">Pool Income</span><span id="poolInc">0.00 AX</span>
        </div>
        <div class="flex gap-2 pt-2">
            <button onclick="claimPoolRewards()" class="btn-gold flex-1 py-1.5 text-[9px] uppercase font-black">Claim Pools</button>
            <button onclick="withdrawIncome()" class="btn-cyan flex-1 py-1.5 text-[9px] uppercase font-black">Claim ROI/Team</button>
        </div>
    </div>

    <img src="buy.png" class="box-header-logo">
    <div class="bg-card p-4 mb-4 border-[#222]">
        <div class="flex justify-between items-center mb-4">
            <span class="text-[10px] text-gray-400 uppercase font-bold italic">Buy FIX <span class="text-white ml-2 text-[11px] not-italic">Fixed Swap</span></span>
            <span class="text-cyan-400 text-[10px] font-bold">1 USDT = <span id="fixRateDisplay">--</span> AX</span>
        </div>
        <div class="relative mb-2">
            <input type="number" id="buyUsdtInput" oninput="calculateSwap()" placeholder="USDT Amount" class="input-box pr-16 text-xs">
            <button onclick="setMaxUsdt()" class="absolute right-3 top-3 text-cyan-400 font-bold text-[11px]">MAX</button>
        </div>
        <div class="text-[10px] text-center text-gray-500 mb-3">You will receive: <span id="estAx" class="text-white font-bold">0.00</span> AX</div>
        <button onclick="buyAsiaXFix()" class="btn-gold w-full py-3 text-xs uppercase tracking-widest flex items-center justify-center gap-2">
            <i class="fa-solid fa-coins"></i> BUY ASIAX FIX
        </button>
    </div>

    <img src="join.png" class="box-header-logo">
    <div class="bg-card p-4 mb-4 border-[#222]">
        <div class="flex justify-between items-center mb-4">
            <span class="text-[10px] text-gray-400 uppercase font-bold italic">Invest <span class="text-white ml-2 text-[11px] not-italic">Join Network</span></span>
        </div>
        <input type="text" id="uplineInput" placeholder="Referrer Address" class="input-box mb-2 text-xs italic">
        <div class="relative">
            <input type="number" id="investAmount" placeholder="Amount (AX)" class="input-box pr-16 text-xs">
            <button onclick="setMaxInvest()" class="absolute right-3 top-3 text-cyan-400 font-bold text-[11px]">MAX</button>
        </div>
        <button onclick="invest()" class="btn-cyan w-full py-3 mt-4 text-xs uppercase tracking-widest flex items-center justify-center gap-2">
            <i class="fa-solid fa-rocket"></i> Invest Now
        </button>
    </div>

    <img src="com.png" class="box-header-logo">
    <div class="bg-card p-4 mb-4 border-[#222]">
        <p class="text-[10px] text-gray-400 uppercase font-bold mb-5 tracking-widest text-center">Community Links</p>
        <div class="flex justify-center gap-10 py-4">
            <a href="https://www.youtube.com/@ASIAXPRO" target="_blank" class="text-center">
                <div class="soc-img-container shadow-[0_0_15px_rgba(255,0,0,0.3)] hover:scale-110"><img src="youtube.png"></div>
                <p class="text-[8px] mt-2 text-gray-400 font-bold uppercase">YouTube</p>
            </a>
            <a href="https://polygonscan.com/address/0xE36b5223d488322fAc2dDda937E5aB226E83Fbbd" target="_blank" class="text-center">
                <div class="soc-img-container shadow-[0_0_15px_rgba(255,255,255,0.2)] hover:scale-110"><img src="polygon.png"></div>
                <p class="text-[8px] mt-2 text-gray-400 font-bold uppercase">Polygon</p>
            </a>
            <a href="https://t.me/asiax_coin" target="_blank" class="text-center">
                <div class="soc-img-container shadow-[0_0_15px_rgba(0,136,204,0.3)] hover:scale-110"><img src="telegram.png"></div>
                <p class="text-[8px] mt-2 text-gray-400 font-bold uppercase">Telegram</p>
            </a>
        </div>
    </div>

    <img src="balance.png" class="box-header-logo">
    <div class="bg-card p-4 mb-4 border-[#222]">
        <p class="text-[10px] text-gray-400 uppercase font-bold mb-4 text-center tracking-widest">Your Wallet Balance</p>
        <div class="grid grid-cols-3 text-center">
            <div><p class="text-[8px] text-gray-500 uppercase font-bold">ASIAX</p><h5 id="bal-asiax" class="text-sm font-bold">0.00</h5></div>
            <div><p class="text-[8px] text-gray-500 uppercase font-bold">USDT</p><h5 id="bal-usdt" class="text-sm font-bold">0.00</h5></div>
            <div><p class="text-[8px] text-gray-500 uppercase font-bold">POL</p><h5 id="bal-pol" class="text-sm font-bold">0.00</h5></div>
        </div>
    </div>

    <img src="team.png" class="box-header-logo">
    <div class="bg-card p-4 mb-4 border-[#222]">
        <p class="text-[10px] text-gray-400 uppercase font-bold mb-5 tracking-widest text-center">Your Network</p>
        <div class="flex justify-between items-center text-center">
            <div><div id="directs" class="circle-lg">0/10</div><p class="text-[8px] text-gray-500 mt-2 uppercase font-bold">Directs</p></div>
            <div><div id="team" class="circle-lg" style="border-top-color:#00F5FF">0</div><p class="text-[8px] text-gray-500 mt-2 uppercase font-bold">Total Team</p></div>
            <div><div id="business" class="circle-lg">0</div><p class="text-[8px] text-gray-500 mt-2 uppercase font-bold">Business (AX)</p></div>
        </div>
    </div>

    <img src="timer.png" class="box-header-logo">
    <div class="bg-card p-4 mb-12 border-[#222]">
        <div class="flex justify-between items-center mb-6">
            <p class="text-[10px] text-gray-400 uppercase font-bold">Pool Performance</p>
            <p id="poolMainStatus" class="text-[8px] bg-red-600 px-2 py-0.5 rounded-sm font-bold text-white">CONNECT WALLET</p>
        </div>
        <div class="space-y-4">
            <div>
                <div class="flex justify-between items-center mb-2 px-1">
                    <span class="text-[10px] font-black text-yellow-500">SILVER (30D)</span>
                    <div id="dot-silver" class="pool-dot">SIL</div>
                </div>
                <div class="timer-row">
                    <div class="timer-part"><span class="timer-val" id="silver-d">00</span><span class="timer-label">D</span></div>
                    <div class="timer-part"><span class="timer-val" id="silver-h">00</span><span class="timer-label">H</span></div>
                    <div class="timer-part"><span class="timer-val" id="silver-m">00</span><span class="timer-label">M</span></div>
                    <div class="timer-part"><span class="timer-val" id="silver-s">00</span><span class="timer-label">S</span></div>
                </div>
            </div>
            <div>
                <div class="flex justify-between items-center mb-2 px-1">
                    <span class="text-[10px] font-black text-cyan-400">GOLD (75D)</span>
                    <div id="dot-gold" class="pool-dot" style="border-top-color:#00F5FF">GOL</div>
                </div>
                <div class="timer-row">
                    <div class="timer-part"><span class="timer-val" id="gold-d">00</span><span class="timer-label">D</span></div>
                    <div class="timer-part"><span class="timer-val" id="gold-h">00</span><span class="timer-label">H</span></div>
                    <div class="timer-part"><span class="timer-val" id="gold-m">00</span><span class="timer-label">M</span></div>
                    <div class="timer-part"><span class="timer-val" id="gold-s">00</span><span class="timer-label">S</span></div>
                </div>
            </div>
            <div>
                <div class="flex justify-between items-center mb-2 px-1">
                    <span class="text-[10px] font-black text-yellow-600">PRO (135D)</span>
                    <div id="dot-plat" class="pool-dot">PRO</div>
                </div>
                <div class="timer-row">
                    <div class="timer-part"><span class="timer-val" id="plat-d">00</span><span class="timer-label">D</span></div>
                    <div class="timer-part"><span class="timer-val" id="plat-h">00</span><span class="timer-label">H</span></div>
                    <div class="timer-part"><span class="timer-val" id="plat-m">00</span><span class="timer-label">M</span></div>
                    <div class="timer-part"><span class="timer-val" id="plat-s">00</span><span class="timer-label">S</span></div>
                </div>
            </div>
        </div>
    </div>
</div>

<script>
    const MAIN_ADDR = "0xF6d0d72AAf0Bbf5C459E680f1e6E75E3B1ce1f06";
    const BUY_FIX_ADDR = "0xCA275a92B4845f3caD2995FaeC00733849C4e6D1"; 
    const TOKEN_ADDR = "0xE36b5223d488322fAc2dDda937E5aB226E83Fbbd";
    const USDT_ADDR = "0xc2132D05D31c914a87C6611C10748AEb04B58e8F";

    const ABI = [
        "function invest(address _referrer, uint256 _amount) external",
        "function withdraw() external",
        "function WalletWithdraw(uint256 _amount) external",
        "function claimPoolRewards() external",
        "function userBasic(address) view returns (address referrer, uint256 totalInvestment, uint256 firstInvestmentTime, uint256 lastROICalculation, uint256 totalWithdrawn, uint256 sponsorIncome, uint256 generationIncome, uint256 totalROIWithdrawn, uint256 totalPoolIncomeWithdrawn, uint256 totalSponsorWithdrawn, uint256 totalGenerationWithdrawn)",
        "function userNetwork(address) view returns (uint256 totalTeam, uint256 activeDirects, bool silverPoolMember, bool goldPoolMember, bool platinumPoolMember, uint256 silverPoolJoinTime, uint256 goldPoolJoinTime, uint256 platinumPoolJoinTime)",
        "function getUserIncome(address _user) view returns (uint256 pendingROI, uint256 sponsorInc, uint256 generationInc, uint256 poolRewards, uint256 totalWithdrawn)",
        "function userWallet(address) view returns (uint256 balance, uint256 lastWithdrawalTime, uint256 withdrawnInLast24Hours)",
        "function getBusinessAndAmount(address) view returns (uint256[50] levelBusiness, uint256[50] levelCount)"
    ];

    const BUY_FIX_ABI = ["function buyAsiaX(uint256 usdtAmount) external", "function getHumanPrice() view returns (uint256)"];
    const ERC20_ABI = ["function balanceOf(address owner) view returns (uint256)", "function approve(address spender, uint256 amount) returns (bool)"];

    let poolInterval, currentRate = 0;
    const nF = (v, d=18) => {
        try { return parseFloat(ethers.formatUnits(v || 0, d)).toLocaleString(undefined, {minimumFractionDigits: 2, maximumFractionDigits: 2}); } catch(e) { return "0.00"; }
    };

    async function loadData(addr) {
        try {
            const [basic, network, income, wallet, bizData, polBal, tokenBal, usdtBal] = await Promise.all([
                mainContract.userBasic(addr), mainContract.userNetwork(addr), mainContract.getUserIncome(addr),
                mainContract.userWallet(addr), mainContract.getBusinessAndAmount(addr), window.provider.getBalance(addr),
                tokenContract.balanceOf(addr), usdtContract.balanceOf(addr)
            ]);

            document.getElementById('uplineAddrDisplay').innerText = basic.referrer;
            let totalBusiness = 0n; bizData.levelBusiness.forEach(b => totalBusiness += b);
            document.getElementById('business').innerText = nF(totalBusiness);
            document.getElementById('bal-pol').innerText = nF(polBal);
            document.getElementById('bal-asiax').innerText = nF(tokenBal);
            document.getElementById('bal-usdt').innerText = nF(usdtBal, 6);

            const deposit = basic.totalInvestment; const roiWithdrawn = basic.totalROIWithdrawn; const maxROI = (deposit * 175n) / 100n;
            document.getElementById('totalDeposit').innerText = nF(deposit) + " AX";
            document.getElementById('roiLimitDisplay').innerText = nF(maxROI);
            document.getElementById('roiEarnedDisplay').innerText = nF(roiWithdrawn);

            let rem = 100; if(maxROI > 0n) { rem = Math.max(0, 100 - Number(roiWithdrawn * 100n / maxROI)); }
            document.getElementById('roiRemainingPercent').innerText = rem;
            document.getElementById('roiBar').style.width = rem + "%";

            document.getElementById('totalIncomeDisplay').innerText = nF(income.totalWithdrawn);
            document.getElementById('roiInc').innerText = nF(income.pendingROI) + " AX";
            document.getElementById('spInc').innerText = nF(income.sponsorInc) + " AX";
            document.getElementById('genInc').innerText = nF(income.generationInc) + " AX";
            document.getElementById('poolInc').innerText = nF(income.poolRewards) + " AX";
            document.getElementById('contractWalletBal').innerText = nF(wallet.balance) + " AX";
            document.getElementById('directs').innerText = network.activeDirects.toString() + "/10";
            document.getElementById('team').innerText = network.totalTeam.toString();

            if(network.silverPoolMember) document.getElementById('dot-silver').classList.add('pool-done');
            if(network.goldPoolMember) document.getElementById('dot-gold').classList.add('pool-done');
            if(network.platinumPoolMember) document.getElementById('dot-plat').classList.add('pool-done');

            const startT = Number(basic.firstInvestmentTime);
            if(startT > 0){
                document.getElementById('poolMainStatus').innerText = "TIMERS ACTIVE";
                document.getElementById('poolMainStatus').className = "text-[8px] bg-green-600 px-2 py-0.5 rounded-sm font-bold text-white";
                if(poolInterval) clearInterval(poolInterval);
                poolInterval = setInterval(() => {
                    const now = Math.floor(Date.now() / 1000);
                    const upd = (id, target) => {
                        const d = (startT + target) - now;
                        if(d > 0){
                            document.getElementById(`${id}-d`).innerText = Math.floor(d/86400).toString().padStart(2,'0');
                            document.getElementById(`${id}-h`).innerText = Math.floor((d%86400)/3600).toString().padStart(2,'0');
                            document.getElementById(`${id}-m`).innerText = Math.floor((d%3600)/60).toString().padStart(2,'0');
                            document.getElementById(`${id}-s`).innerText = Math.floor(d%60).toString().padStart(2,'0');
                        }
                    };
                    upd('silver', 30*86400); upd('gold', 75*86400); upd('plat', 135*86400);
                }, 1000);
            }
            const rate = await buyFixContract.getHumanPrice(); currentRate = Number(rate);
            document.getElementById('fixRateDisplay').innerText = currentRate;
        } catch (e) { console.error(e); }
    }

    // Attach all functions to window so they are globally available
    window.calculateSwap = () => { const val = document.getElementById('buyUsdtInput').value; document.getElementById('estAx').innerText = (val * currentRate).toFixed(2); };
    window.invest = async () => {
        const amt = document.getElementById('investAmount').value;
        if(!amt || amt < 10) return alert("Min 10 AX required");
        let ref = document.getElementById('uplineInput').value;
        if(!ethers.isAddress(ref)) ref = "0x0000000000000000000000000000000000000000";
        try {
            const wei = ethers.parseUnits(amt.toString(), 18);
            const txA = await tokenContract.approve(MAIN_ADDR, wei); await txA.wait();
            const txI = await mainContract.invest(ref, wei); await txI.wait();
            alert("Successful!"); loadData(await signer.getAddress());
        } catch(e) { alert("Failed"); }
    };
    window.buyAsiaXFix = async () => {
        const amt = document.getElementById('buyUsdtInput').value;
        try {
            const wei = ethers.parseUnits(amt.toString(), 6);
            const txA = await usdtContract.approve(BUY_FIX_ADDR, wei); await txA.wait();
            const txB = await buyFixContract.buyAsiaX(wei); await txB.wait();
            alert("Successful!"); loadData(await signer.getAddress());
        } catch(e) { alert("Failed"); }
    };
    window.withdrawIncome = async () => { try { const tx = await mainContract.withdraw(); await tx.wait(); loadData(await signer.getAddress()); } catch(e) { alert("Failed"); } };
    window.claimPoolRewards = async () => { try { const tx = await mainContract.claimPoolRewards(); await tx.wait(); loadData(await signer.getAddress()); } catch(e) { alert("Failed"); } };
    window.walletWithdraw = async () => {
        const amt = document.getElementById('withdrawInput').value;
        try { const tx = await mainContract.WalletWithdraw(ethers.parseUnits(amt.toString(), 18)); await tx.wait(); loadData(await signer.getAddress()); } catch(e) { alert("Failed"); }
    };
    window.setMaxWithdraw = () => { const bal = document.getElementById('contractWalletBal').innerText.split(' ')[0].replace(/,/g, ''); document.getElementById('withdrawInput').value = Math.min(bal, 1000); };
    window.setMaxInvest = () => { document.getElementById('investAmount').value = document.getElementById('bal-asiax').innerText.replace(/,/g, ''); };
    window.setMaxUsdt = () => { document.getElementById('buyUsdtInput').value = document.getElementById('bal-usdt').innerText.replace(/,/g, ''); window.calculateSwap(); };
    window.copyText = (id) => { const el = document.getElementById(id); navigator.clipboard.writeText(el.tagName==='INPUT'?el.value:el.innerText); alert("Copied!"); };
</script>
</body>
</html>

